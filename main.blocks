<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="[WNk=7%`~mNVNs[vF|6V" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="jHVli^k5;j?iFuZ)VI{L" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum oma_object {" line1="    //% block=&quot;數字輸出&quot;" line2="    Digital_Output = 3201," line3="    //% block=&quot;模擬輸出&quot;" line4="    Analog_Output = 3203," line5="    //% block=&quot;通用傳感器&quot;" line6="    Generic_Sensor = 3300," line7="    //% block=&quot;照度&quot;" line8="    Illuminance = 3301," line9="    //% block=&quot;存在&quot;" line10="    Presence = 3302," line11="    //% block=&quot;溫度&quot;" line12="    Temperature = 3303," line13="    //% block=&quot;功率測量&quot;" line14="    Power_Measurement = 3302," line15="" line16="}" numlines="17"></mutation><next><block type="typescript_statement" id="wj/Mzr)BF7#F[xGqi39R" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum oma_object_subid {" line1="    //% block=&quot;General&quot;" line2="    Three = 5550," line3="    //% block=&quot;two&quot;" line4="    Two = 3301," line5="    //% block=&quot;year&quot; " line6="    YEAR = 3340," line7="}" numlines="8"></mutation><next><block type="typescript_statement" id="BUE*3O%1pq/Q5x|WTu.m" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace CMHK {" line1="" line2="" line3="    /**" line4="     * 向 NB-IoT 模塊請求 IMSI" line5="     */" line6="    //% blockId=&quot;nb_check_imsi&quot; block=&quot;請求 IMSI&quot;" line7="    //% group=&quot;NB-IoT&quot;" line8="    export function checkImsi(): void {" line9="        serial.redirect(" line10="            SerialPin.P12," line11="            SerialPin.P8," line12="            BaudRate.BaudRate9600" line13="        )" line14="        serial.writeLine(&quot;AT+CIMI&quot;)" line15="    }" line16="" line17="    /**" line18="     * 向 NB-IoT 模塊請求 IMEI " line19="     */" line20="    //% blockId=&quot;nb_check_imei&quot; block=&quot;請求 IMEI&quot;" line21="    //% group=&quot;NB-IoT&quot;" line22="    export function checkImei(): void {" line23="        serial.redirect(" line24="            SerialPin.P12," line25="            SerialPin.P8," line26="            BaudRate.BaudRate9600" line27="        )" line28="        serial.writeLine(&quot;AT+CGSN=1&quot;)" line29="    }" line30="" line31="" line32="    /**" line33="     * 檢查信號強度" line34="     */" line35="    //% blockId=&quot;nb_check_signal&quot; block=&quot;檢查信號強度&quot;" line36="    //% group=&quot;NB-IoT&quot;" line37="    " line38="    export function checkSignal(): void {" line39="        serial.redirect(" line40="            SerialPin.P12," line41="            SerialPin.P8," line42="            BaudRate.BaudRate9600" line43="        )" line44="        serial.writeLine(&quot;AT+CSQ&quot;)" line45="    }" line46="" line47="    /**" line48="     * Request AT+MIPLCREATE" line49="     */" line50="    //% blockId=&quot;nb_miplcreate&quot; block=&quot;註冊設備&quot;" line51="    //% group=&quot;NB-IoT&quot;" line52="    export function nb_miplcreate(): void {" line53="        serial.redirect(" line54="            SerialPin.P12," line55="            SerialPin.P8," line56="            BaudRate.BaudRate9600" line57="        )" line58="        serial.writeLine(&quot;AT+MIPLCREATE&quot;)" line59="    }" line60="" line61="    /**" line62="     * NB-IoT 打開連接" line63="     * @param value describe value here, eg: 60" line64="     */" line65="" line66="    //% blockId=&quot;nb_open_connection&quot; block=&quot;NB-IoT 打開連接 %value 秒&quot;" line67="    //% group=&quot;NB-IoT&quot;" line68="    export function nb_open_connection(value: number): void {" line69="        serial.redirect(" line70="            SerialPin.P12," line71="            SerialPin.P8," line72="            BaudRate.BaudRate9600" line73="        )" line74="        serial.writeLine(&quot;AT+MIPLOPEN=0,&quot; + value)" line75="    }" line76="" line77="    /**" line78="     * NB-IoT 更新連接" line79="     * @param value describe value here, eg: 120" line80="     */" line81="" line82="    //% blockId=&quot;nb_update_connection&quot; block=&quot;NB-IoT 更新連接 %value 秒&quot;" line83="    //% group=&quot;NB-IoT&quot;" line84="    export function nb_update_connection(value: number): void {" line85="        serial.redirect(" line86="            SerialPin.P12," line87="            SerialPin.P8," line88="            BaudRate.BaudRate9600" line89="        )" line90="        serial.writeLine(&quot;AT+MIPLUPDATE=0,&quot; + value + &quot;, 0&quot;)" line91="    }" line92="" line93="    /**" line94=" * NB-IoT 關閉連接" line95=" */" line96="" line97="    //% blockId=&quot;nb_close_conn&quot; block=&quot;NB-IoT 關閉連接&quot;" line98="    //% group=&quot;NB-IoT&quot;" line99="    export function nb_close_connection(): void {" line100="        serial.redirect(" line101="            SerialPin.P12," line102="            SerialPin.P8," line103="            BaudRate.BaudRate9600" line104="        )" line105="        serial.writeLine(&quot;AT+MIPLCLOSE=0&quot;)" line106="    }" line107="" line108="" line109="" line110="" line111="    /**" line112="     * NB-IoT 添加對象" line113="     * @param value describe value here, eg: 5" line114="     */" line115="" line116="    //% blockId=&quot;nb_add_obj&quot; block=&quot;NB-IoT 添加對象&quot;" line117="    //% group=&quot;NB-IoT&quot;" line118="    export function nb_add_obj(): void {" line119="        serial.redirect(" line120="            SerialPin.P12," line121="            SerialPin.P8," line122="            BaudRate.BaudRate9600" line123="        )" line124="        serial.writeLine(&quot;AT+MIPLADDOBJ=0, 3304, 2, \&quot;11\&quot;, 0, 0&quot;)" line125="    }" line126="" line127="" line128="    /**" line129="     * NB-IoT 通知對象" line130="     * @param value describe value here, eg: 5" line131="     */" line132="" line133="    //% blockId=&quot;nb_notify_obj&quot; block=&quot;NB-IoT 通知對象 %value&quot;" line134="    //% group=&quot;NB-IoT&quot;" line135="    export function nb_notify_obj(value: number): void {" line136="        serial.redirect(" line137="            SerialPin.P12," line138="            SerialPin.P8," line139="            BaudRate.BaudRate9600" line140="        )" line141="        serial.writeLine(&quot;AT+MIPLNOTIFY=0,0,3304,0,5700,4,4,&quot; + value + &quot;,0,0&quot;)" line142="    }" line143="" line144="" line145="    /**" line146="     * MQTT 設定 WiFi SSID" line147="     * @param value describe value here, eg: &quot;WIFI NAME&quot;" line148="     */" line149="" line150="    //% blockId=&quot;mqtt_wifi_ssid&quot; block=&quot;MQTT 設定 WiFi SSID: %value&quot;" line151="    //% group=&quot;MQTT&quot;" line152="    //% advanced=true" line153="    export function mqtt_wifi_ssid(value: string): void {" line154="        serial.redirect(" line155="            SerialPin.P12," line156="            SerialPin.P8," line157="            BaudRate.BaudRate9600" line158="        )" line159="        serial.writeLine(&quot;AT+SSID=&quot; + value)" line160="    }" line161="" line162="    /**" line163="     * MQTT 設定 WiFi 密碼" line164="     * @param value describe value here, eg: &quot;WIFI Password&quot;" line165="     */" line166="" line167="    //% blockId=&quot;mqtt_wifi_pw&quot; block=&quot;MQTT 設定 WiFi 密碼: %value&quot;" line168="    //% group=&quot;MQTT&quot;" line169="    //% advanced=true" line170="    export function mqtt_wifi_pw(value: string): void {" line171="        serial.redirect(" line172="            SerialPin.P12," line173="            SerialPin.P8," line174="            BaudRate.BaudRate9600" line175="        )" line176="        serial.writeLine(&quot;AT+PW=&quot; + value)" line177="    }" line178="" line179="    /**" line180="         * MQTT 設定產品ID" line181="         * @param value describe value here, eg: &quot;16001111&quot;" line182="         */" line183="" line184="    //% blockId=&quot;mqtt_set_pid&quot; block=&quot;MQTT 設定產品ID: %value&quot;" line185="    //% group=&quot;MQTT&quot;" line186="    //% advanced=true" line187="    export function mqtt_set_pid(value: number): void {" line188="        serial.redirect(" line189="            SerialPin.P12," line190="            SerialPin.P8," line191="            BaudRate.BaudRate9600" line192="        )" line193="        serial.writeLine(&quot;AT+PID=&quot; + value)" line194="    }" line195="" line196="    /**" line197="         * MQTT 設定設備ID" line198="         * @param value describe value here, eg: &quot;161200005&quot;" line199="         */" line200="" line201="    //% blockId=&quot;mqtt_set_did&quot; block=&quot;MQTT 設定設備ID: %value&quot;" line202="    //% group=&quot;MQTT&quot;" line203="    //% advanced=true" line204="    export function mqtt_set_did(value: number): void {" line205="        serial.redirect(" line206="            SerialPin.P12," line207="            SerialPin.P8," line208="            BaudRate.BaudRate9600" line209="        )" line210="        serial.writeLine(&quot;AT+DID=&quot; + value)" line211="    }" line212="" line213="    /**" line214="          * MQTT 設定鑒權密碼" line215="          * @param value describe value here, eg: &quot;device_pw&quot;" line216="          */" line217="" line218="    //% blockId=&quot;mqtt_set_dpw&quot; block=&quot;MQTT 設定鑒權密碼: %value&quot;" line219="    //% group=&quot;MQTT&quot;" line220="    //% advanced=true" line221="    export function mqtt_set_dpw(value: string): void {" line222="        serial.redirect(" line223="            SerialPin.P12," line224="            SerialPin.P8," line225="            BaudRate.BaudRate9600" line226="        )" line227="        serial.writeLine(&quot;AT+DPW=&quot; + value)" line228="    }" line229="" line230="    /**" line231="     * MQTT 檢視設備信息 " line232="     */" line233="" line234="    //% blockId=&quot;mqtt_check_info&quot; block=&quot;MQTT 檢視設備信息&quot;" line235="    //% group=&quot;MQTT&quot;" line236="    export function mqtt_check_info(): void {" line237="        serial.redirect(" line238="            SerialPin.P12," line239="            SerialPin.P8," line240="            BaudRate.BaudRate9600" line241="        )" line242="        serial.writeLine(&quot;AT+INFO?&quot;)" line243="    }" line244="" line245="    /**" line246="     * MQTT 連接WiFi " line247="     * @param value describe value here, eg: 5" line248="     */" line249="" line250="    //% blockId=&quot;mqtt_wifi_conn&quot; block=&quot;MQTT 連接WiFi,嘗試次數 %value&quot;" line251="    //% group=&quot;MQTT&quot;" line252="    export function mqtt_wifi_conn(value: number): void {" line253="        serial.redirect(" line254="            SerialPin.P12," line255="            SerialPin.P8," line256="            BaudRate.BaudRate9600" line257="        )" line258="        serial.writeLine(&quot;AT+CONN=&quot; + value)" line259="    }" line260="" line261="    /**" line262="     * MQTT 檢查WiFi連接" line263="     */" line264="" line265="    //% blockId=&quot;mqtt_check_wificonn&quot; block=&quot;MQTT 檢查WiFi連接&quot;" line266="    //% group=&quot;MQTT&quot;" line267="    export function mqtt_check_wificonn(): void {" line268="        serial.redirect(" line269="            SerialPin.P12," line270="            SerialPin.P8," line271="            BaudRate.BaudRate9600" line272="        )" line273="        serial.writeLine(&quot;AT+CONN?&quot;)" line274="    }" line275="" line276="" line277="    /**" line278="     * MQTT 連接OneNET " line279="     * @param value describe value here, eg: 5" line280="     */" line281="" line282="    //% blockId=&quot;mqtt_onenet_conn&quot; block=&quot;MQTT 連接OneNET,嘗試次數 %value&quot;" line283="    //% group=&quot;MQTT&quot;" line284="    export function mqtt_onenet_conn(value: number): void {" line285="        serial.redirect(" line286="            SerialPin.P12," line287="            SerialPin.P8," line288="            BaudRate.BaudRate9600" line289="        )" line290="        serial.writeLine(&quot;AT+MQTTCONN=&quot; + value)" line291="    }" line292="" line293="    /**" line294="     * MQTT 發送數據 " line295="     * @param topic 發送的主題名稱, eg: Temperature" line296="     * @param value 發送的數值, eg: 30.2" line297="     */" line298="" line299="    //% blockId=&quot;mqtt_send_data&quot; block=&quot;MQTT 發送主題 %topic 數值為 %value&quot;" line300="    //% group=&quot;MQTT&quot;" line301="    export function mqtt_send_data(topic: string, value: number): void {" line302="        serial.redirect(" line303="            SerialPin.P12," line304="            SerialPin.P8," line305="            BaudRate.BaudRate9600" line306="        )" line307="        serial.writeLine(&quot;AT+SEND=&quot; + topic + &quot;,&quot; + value)" line308="    }" line309="" line310="" line311="    /**" line312="        * MQTT 檢查接收數據 " line313="        * 回傳由OneNeT平台下傳的訊息,如非下傳的訊息則回傳空白" line314="        * @param data Input String, eg: &quot;Recieve_String&quot;" line315="        */" line316="" line317="    //% blockId=&quot;mqtt_check_revcdata&quot; block=&quot;MQTT 檢查接收數據  %data&quot;" line318="    //% group=&quot;MQTT&quot;" line319="    export function mqtt_check_revcdata(data: string): string {" line320="        if (data.includes(&quot;[R]&quot;)) {" line321="            return data.substr(3, data.length)" line322="        }" line323="        return &quot;&quot;" line324="    }" line325="" line326="    /**" line327="           * 設定所有MQTT信息 " line328="           * @param ssid Wi-Fi名稱, eg: &quot;Wi-Fi_Name&quot;" line329="           * @param password Wi-Fi 密碼, eg: &quot;Wi-Fi_Password&quot;" line330="           * @param pid 產品ID, eg: &quot;16001111&quot;" line331="           * @param did 設備ID, eg: &quot;161200005&quot;" line332="           * @param dpw 鑒權密碼, eg: &quot;device_pw&quot;" line333="           * @param autoConnect 是否需要設定後馬上進行連接?" line334="           */" line335="    //% blockId=&quot;mqtt_master_setup&quot; block=&quot;設定MQTT信息|Wi-Fi SSID $ssid|Wi-Fi 密碼 $password|產品ID $pid|設備ID $did|鑒權密碼 $dpw|自動連接 $autoConnect&quot;" line336="    //% autoConnect.defl=true" line337="    export function mqtt_master_setup(ssid: string, password: string, pid: number, did: number, dpw: string, autoConnect: boolean): void {" line338="        mqtt_wifi_ssid(ssid)" line339="        mqtt_wifi_pw(password)" line340="        mqtt_set_pid(pid)" line341="        mqtt_set_did(did)" line342="        mqtt_set_dpw(dpw)" line343="" line344="        if(autoConnect){" line345="            mqtt_wifi_conn(5)" line346="            basic.pause(500)" line347="            mqtt_onenet_conn(5)" line348="            basic.pause(500)" line349="        }" line350="    }" line351="" line352="" line353="}" numlines="354"></mutation></block></next></block></next></block></statement></block></xml>