<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="UvE3QixK7lbT(1l}jV,V" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="}!,~gW7jjRtk1bh*Rw17" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum oma_object {" line1="    //% block=&quot;數字輸出&quot;" line2="    Digital_Output = 3201," line3="    //% block=&quot;模擬輸出&quot;" line4="    Analog_Output = 3203," line5="    //% block=&quot;通用傳感器&quot;" line6="    Generic_Sensor = 3300," line7="    //% block=&quot;照度&quot;" line8="    Illuminance = 3301," line9="    //% block=&quot;存在&quot;" line10="    Presence = 3302," line11="    //% block=&quot;溫度&quot;" line12="    Temperature = 3303," line13="    //% block=&quot;功率測量&quot;" line14="    Power_Measurement = 3302," line15="" line16="}" numlines="17"></mutation><next><block type="typescript_statement" id="J$#Opfe,6Z6:YnVZmyyw" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum oma_object_subid {" line1="    //% block=&quot;General&quot;" line2="    Three = 5550," line3="    //% block=&quot;two&quot;" line4="    Two = 3301," line5="    //% block=&quot;year&quot; " line6="    YEAR = 3340," line7="}" numlines="8"></mutation><next><block type="typescript_statement" id="OYoD8*CI`O:J~uw#TPye" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace CMHK {" line1="" line2="" line3="    /**" line4="     * 向 NB-IoT 模塊請求 IMSI" line5="     */" line6="    //% blockId=&quot;nb_check_imsi&quot; block=&quot;請求 IMSI&quot;" line7="    //% group=&quot;NB-IoT&quot;" line8="    export function checkImsi(): void {" line9="        serial.redirect(" line10="            SerialPin.P12," line11="            SerialPin.P8," line12="            BaudRate.BaudRate9600" line13="        )" line14="        serial.writeLine(&quot;AT+CIMI&quot;)" line15="    }" line16="" line17="    /**" line18="     * 向 NB-IoT 模塊請求 IMEI " line19="     */" line20="    //% blockId=&quot;nb_check_imei&quot; block=&quot;請求 IMEI&quot;" line21="    //% group=&quot;NB-IoT&quot;" line22="    export function checkImei(): void {" line23="        serial.redirect(" line24="            SerialPin.P12," line25="            SerialPin.P8," line26="            BaudRate.BaudRate9600" line27="        )" line28="        serial.writeLine(&quot;AT+CGSN=1&quot;)" line29="    }" line30="" line31="" line32="    /**" line33="     * 檢查信號強度" line34="     */" line35="    //% blockId=&quot;nb_check_signal&quot; block=&quot;檢查信號強度&quot;" line36="    //% group=&quot;NB-IoT&quot;" line37="    export function checkSignal(): void {" line38="        serial.redirect(" line39="            SerialPin.P12," line40="            SerialPin.P8," line41="            BaudRate.BaudRate9600" line42="        )" line43="        serial.writeLine(&quot;AT+CSQ&quot;)" line44="    }" line45="" line46="    /**" line47="     * Request AT+MIPLCREATE" line48="     */" line49="    //% blockId=&quot;nb_miplcreate&quot; block=&quot;註冊設備&quot;" line50="    //% group=&quot;NB-IoT&quot;" line51="    export function nb_miplcreate(): void {" line52="        serial.redirect(" line53="            SerialPin.P12," line54="            SerialPin.P8," line55="            BaudRate.BaudRate9600" line56="        )" line57="        serial.writeLine(&quot;AT+MIPLCREATE&quot;)" line58="    }" line59="" line60="    /**" line61="     * NB-IoT 打開連接" line62="     * @param value describe value here, eg: 60" line63="     */" line64="" line65="    //% blockId=&quot;nb_open_connection&quot; block=&quot;NB-IoT 打開連接 %value 秒&quot;" line66="    //% group=&quot;NB-IoT&quot;" line67="    export function nb_open_connection(value: number): void {" line68="        serial.redirect(" line69="            SerialPin.P12," line70="            SerialPin.P8," line71="            BaudRate.BaudRate9600" line72="        )" line73="        serial.writeLine(&quot;AT+MIPLOPEN=0,&quot; + value)" line74="    }" line75="" line76="    /**" line77="     * NB-IoT 更新連接" line78="     * @param value describe value here, eg: 120" line79="     */" line80="" line81="    //% blockId=&quot;nb_update_connection&quot; block=&quot;NB-IoT 更新連接 %value 秒&quot;" line82="    //% group=&quot;NB-IoT&quot;" line83="    export function nb_update_connection(value: number): void {" line84="        serial.redirect(" line85="            SerialPin.P12," line86="            SerialPin.P8," line87="            BaudRate.BaudRate9600" line88="        )" line89="        serial.writeLine(&quot;AT+MIPLUPDATE=0,&quot; + value + &quot;, 0&quot;)" line90="    }" line91="" line92="    /**" line93=" * NB-IoT 關閉連接" line94=" */" line95="" line96="    //% blockId=&quot;nb_close_conn&quot; block=&quot;NB-IoT 關閉連接&quot;" line97="    //% group=&quot;NB-IoT&quot;" line98="    export function nb_close_connection(): void {" line99="        serial.redirect(" line100="            SerialPin.P12," line101="            SerialPin.P8," line102="            BaudRate.BaudRate9600" line103="        )" line104="        serial.writeLine(&quot;AT+MIPLCLOSE=0&quot;)" line105="    }" line106="" line107="" line108="" line109="" line110="    /**" line111="     * NB-IoT 添加對象" line112="     * @param value describe value here, eg: 5" line113="     */" line114="" line115="    //% blockId=&quot;nb_add_obj&quot; block=&quot;NB-IoT 添加對象&quot;" line116="    //% group=&quot;NB-IoT&quot;" line117="    export function nb_add_obj(): void {" line118="        serial.redirect(" line119="            SerialPin.P12," line120="            SerialPin.P8," line121="            BaudRate.BaudRate9600" line122="        )" line123="        serial.writeLine(&quot;AT+MIPLADDOBJ=0, 3304, 2, \&quot;11\&quot;, 0, 0&quot;)" line124="    }" line125="" line126="" line127="    /**" line128="     * NB-IoT 通知對象" line129="     * @param value describe value here, eg: 5" line130="     */" line131="" line132="    //% blockId=&quot;nb_notify_obj&quot; block=&quot;NB-IoT 通知對象 %value&quot;" line133="    //% group=&quot;NB-IoT&quot;" line134="    export function nb_notify_obj(value: number): void {" line135="        serial.redirect(" line136="            SerialPin.P12," line137="            SerialPin.P8," line138="            BaudRate.BaudRate9600" line139="        )" line140="        serial.writeLine(&quot;AT+MIPLNOTIFY=0,0,3304,0,5700,4,4,&quot; + value + &quot;,0,0&quot;)" line141="    }" line142="" line143="" line144="    /**" line145="     * MQTT 設定 WiFi SSID" line146="     * @param value describe value here, eg: &quot;WIFI NAME&quot;" line147="     */" line148="" line149="    //% blockId=&quot;mqtt_wifi_ssid&quot; block=&quot;MQTT 設定 WiFi SSID: %value&quot;" line150="    //% group=&quot;MQTT&quot;" line151="    export function mqtt_wifi_ssid(value: string): void {" line152="        serial.redirect(" line153="            SerialPin.P12," line154="            SerialPin.P8," line155="            BaudRate.BaudRate9600" line156="        )" line157="        serial.writeLine(&quot;AT+SSID=&quot; + value)" line158="    }" line159="" line160="    /**" line161="     * MQTT 設定 WiFi 密碼" line162="     * @param value describe value here, eg: &quot;WIFI Password&quot;" line163="     */" line164="" line165="    //% blockId=&quot;mqtt_wifi_pw&quot; block=&quot;MQTT 設定 WiFi 密碼: %value&quot;" line166="    //% group=&quot;MQTT&quot;" line167="    export function mqtt_wifi_pw(value: string): void {" line168="        serial.redirect(" line169="            SerialPin.P12," line170="            SerialPin.P8," line171="            BaudRate.BaudRate9600" line172="        )" line173="        serial.writeLine(&quot;AT+PW=&quot; + value)" line174="    }" line175="" line176="    /**" line177="         * MQTT 設定產品ID" line178="         * @param value describe value here, eg: &quot;16001111&quot;" line179="         */" line180="" line181="    //% blockId=&quot;mqtt_set_pid&quot; block=&quot;MQTT 設定產品ID: %value&quot;" line182="    //% group=&quot;MQTT&quot;" line183="    export function mqtt_set_pid(value: number): void {" line184="        serial.redirect(" line185="            SerialPin.P12," line186="            SerialPin.P8," line187="            BaudRate.BaudRate9600" line188="        )" line189="        serial.writeLine(&quot;AT+PID=&quot; + value)" line190="    }" line191="" line192="    /**" line193="         * MQTT 設定設備ID" line194="         * @param value describe value here, eg: &quot;161200005&quot;" line195="         */" line196="" line197="    //% blockId=&quot;mqtt_set_did&quot; block=&quot;MQTT 設定設備ID: %value&quot;" line198="    //% group=&quot;MQTT&quot;" line199="    export function mqtt_set_did(value: number): void {" line200="        serial.redirect(" line201="            SerialPin.P12," line202="            SerialPin.P8," line203="            BaudRate.BaudRate9600" line204="        )" line205="        serial.writeLine(&quot;AT+DID=&quot; + value)" line206="    }" line207="" line208="    /**" line209="          * MQTT 設定鑒權密碼" line210="          * @param value describe value here, eg: &quot;device_pw&quot;" line211="          */" line212="" line213="    //% blockId=&quot;mqtt_set_dpw&quot; block=&quot;MQTT 設定鑒權密碼: %value&quot;" line214="    //% group=&quot;MQTT&quot;v" line215="    export function mqtt_set_dpw(value: string): void {" line216="        serial.redirect(" line217="            SerialPin.P12," line218="            SerialPin.P8," line219="            BaudRate.BaudRate9600" line220="        )" line221="        serial.writeLine(&quot;AT+DPW=&quot; + value)" line222="    }" line223="" line224="    /**" line225="     * MQTT 檢視設備信息 " line226="     */" line227="" line228="    //% blockId=&quot;mqtt_check_info&quot; block=&quot;MQTT 檢視設備信息&quot;" line229="    //% group=&quot;MQTT&quot;" line230="    export function mqtt_check_info(): void {" line231="        serial.redirect(" line232="            SerialPin.P12," line233="            SerialPin.P8," line234="            BaudRate.BaudRate9600" line235="        )" line236="        serial.writeLine(&quot;AT+INFO?&quot;)" line237="    }" line238="" line239="    /**" line240="     * MQTT 連接WiFi " line241="     * @param value describe value here, eg: 5" line242="     */" line243="" line244="    //% blockId=&quot;mqtt_wifi_conn&quot; block=&quot;MQTT 連接WiFi,嘗試次數 %value&quot;" line245="    //% group=&quot;MQTT&quot;" line246="    export function mqtt_wifi_conn(value: number): void {" line247="        serial.redirect(" line248="            SerialPin.P12," line249="            SerialPin.P8," line250="            BaudRate.BaudRate9600" line251="        )" line252="        serial.writeLine(&quot;AT+CONN=&quot; + value)" line253="    }" line254="" line255="    /**" line256="     * MQTT 檢查WiFi連接" line257="     */" line258="" line259="    //% blockId=&quot;mqtt_check_wificonn&quot; block=&quot;MQTT 檢查WiFi連接&quot;" line260="    //% group=&quot;MQTT&quot;" line261="    export function mqtt_check_wificonn(): void {" line262="        serial.redirect(" line263="            SerialPin.P12," line264="            SerialPin.P8," line265="            BaudRate.BaudRate9600" line266="        )" line267="        serial.writeLine(&quot;AT+CONN?&quot;)" line268="    }" line269="" line270="" line271="    /**" line272="     * MQTT 連接OneNET " line273="     * @param value describe value here, eg: 5" line274="     */" line275="" line276="    //% blockId=&quot;mqtt_onenet_conn&quot; block=&quot;MQTT 連接OneNET,嘗試次數 %value&quot;" line277="    //% group=&quot;MQTT&quot;" line278="    export function mqtt_onenet_conn(value: number): void {" line279="        serial.redirect(" line280="            SerialPin.P12," line281="            SerialPin.P8," line282="            BaudRate.BaudRate9600" line283="        )" line284="        serial.writeLine(&quot;AT+MQTTCONN=&quot; + value)" line285="    }" line286="" line287="    /**" line288="     * MQTT 發送數據 " line289="     * @param topic 發送的主題名稱, eg: Temperature" line290="     * @param value 發送的數值, eg: 30.2" line291="     */" line292="" line293="    //% blockId=&quot;mqtt_send_data&quot; block=&quot;MQTT 發送主題 %topic 數值為 %value&quot;" line294="    //% group=&quot;MQTT&quot;" line295="    export function mqtt_send_data(topic: string, value: number): void {" line296="        serial.redirect(" line297="            SerialPin.P12," line298="            SerialPin.P8," line299="            BaudRate.BaudRate9600" line300="        )" line301="        serial.writeLine(&quot;AT+SEND=&quot; + topic + &quot;,&quot; + value)" line302="    }" line303="" line304="" line305="    /**" line306="        * MQTT 檢查接收數據 " line307="        * 回傳由OneNeT平台下傳的訊息,如非下傳的訊息則回傳空白" line308="        * @param data Input String, eg: &quot;Recieve_String&quot;" line309="        */" line310="" line311="    //% blockId=&quot;mqtt_check_revcdata&quot; block=&quot;MQTT 檢查接收數據  %data&quot;" line312="    //% group=&quot;MQTT&quot;" line313="    export function mqtt_check_revcdata(data: string): string {" line314="        if (data.includes(&quot;[R]&quot;)) {" line315="            return data.substr(3, data.length)" line316="        }" line317="        return &quot;&quot;" line318="    }" line319="" line320="}" numlines="321"></mutation></block></next></block></next></block></statement></block></xml>