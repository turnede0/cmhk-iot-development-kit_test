<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="h1^.zI(ep,Ua1|L`Yz%j" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="K,R8S6e!a3hQ)Us2GT5g" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum oma_object {" line1="    //% block=&quot;數字輸出&quot;" line2="    Digital_Output = 3201," line3="    //% block=&quot;模擬輸出&quot;" line4="    Analog_Output = 3203," line5="    //% block=&quot;通用傳感器&quot;" line6="    Generic_Sensor = 3300," line7="    //% block=&quot;照度&quot;" line8="    Illuminance = 3301," line9="    //% block=&quot;存在&quot;" line10="    Presence = 3302," line11="    //% block=&quot;溫度&quot;" line12="    Temperature = 3303," line13="    //% block=&quot;功率測量&quot;" line14="    Power_Measurement = 3302," line15="" line16="}" numlines="17"></mutation><next><block type="typescript_statement" id="G%3/H3!VwhE|AjhSvL8U" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum oma_object_subid {" line1="    //% block=&quot;General&quot;" line2="    Three = 5550," line3="    //% block=&quot;two&quot;" line4="    Two = 3301," line5="    //% block=&quot;year&quot; " line6="    YEAR = 3340," line7="}" numlines="8"></mutation><next><block type="typescript_statement" id="(1boP~!F./(@)SKo#.d?" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace CMHK {" line1="" line2="" line3="    /**" line4="     * 向 NB-IoT 模塊請求 IMSI" line5="     */" line6="    //% blockId=&quot;nb_check_imsi&quot; block=&quot;請求 IMSI&quot;" line7="    //% group=&quot;NB-IoT&quot;" line8="    export function checkImsi(): void {" line9="        serial.redirect(" line10="            SerialPin.P12," line11="            SerialPin.P8," line12="            BaudRate.BaudRate9600" line13="        )" line14="        serial.writeLine(&quot;AT+CIMI&quot;)" line15="    }" line16="" line17="    /**" line18="     * 向 NB-IoT 模塊請求 IMEI " line19="     */" line20="    //% blockId=&quot;nb_check_imei&quot; block=&quot;請求 IMEI&quot;" line21="    //% group=&quot;NB-IoT&quot;" line22="    export function checkImei(): void {" line23="        serial.redirect(" line24="            SerialPin.P12," line25="            SerialPin.P8," line26="            BaudRate.BaudRate9600" line27="        )" line28="        serial.writeLine(&quot;AT+CGSN=1&quot;)" line29="    }" line30="" line31="" line32="    /**" line33="     * 檢查信號強度" line34="     */" line35="    //% blockId=&quot;nb_check_signal&quot; block=&quot;檢查信號強度&quot;" line36="    //% group=&quot;NB-IoT&quot;" line37="    " line38="    export function checkSignal(): void {" line39="        serial.redirect(" line40="            SerialPin.P12," line41="            SerialPin.P8," line42="            BaudRate.BaudRate9600" line43="        )" line44="        serial.writeLine(&quot;AT+CSQ&quot;)" line45="    }" line46="" line47="    /**" line48="     * Request AT+MIPLCREATE" line49="     */" line50="    //% blockId=&quot;nb_miplcreate&quot; block=&quot;註冊設備&quot;" line51="    //% group=&quot;NB-IoT&quot;" line52="    export function nb_miplcreate(): void {" line53="        serial.redirect(" line54="            SerialPin.P12," line55="            SerialPin.P8," line56="            BaudRate.BaudRate9600" line57="        )" line58="        serial.writeLine(&quot;AT+MIPLCREATE&quot;)" line59="    }" line60="" line61="    /**" line62="     * NB-IoT 打開連接" line63="     * @param value describe value here, eg: 60" line64="     */" line65="" line66="    //% blockId=&quot;nb_open_connection&quot; block=&quot;NB-IoT 打開連接 %value 秒&quot;" line67="    //% group=&quot;NB-IoT&quot;" line68="    export function nb_open_connection(value: number): void {" line69="        serial.redirect(" line70="            SerialPin.P12," line71="            SerialPin.P8," line72="            BaudRate.BaudRate9600" line73="        )" line74="        serial.writeLine(&quot;AT+MIPLOPEN=0,&quot; + value)" line75="    }" line76="" line77="    /**" line78="     * NB-IoT 更新連接" line79="     * @param value describe value here, eg: 120" line80="     */" line81="" line82="    //% blockId=&quot;nb_update_connection&quot; block=&quot;NB-IoT 更新連接 %value 秒&quot;" line83="    //% group=&quot;NB-IoT&quot;" line84="    export function nb_update_connection(value: number): void {" line85="        serial.redirect(" line86="            SerialPin.P12," line87="            SerialPin.P8," line88="            BaudRate.BaudRate9600" line89="        )" line90="        serial.writeLine(&quot;AT+MIPLUPDATE=0,&quot; + value + &quot;, 0&quot;)" line91="    }" line92="" line93="    /**" line94=" * NB-IoT 關閉連接" line95=" */" line96="" line97="    //% blockId=&quot;nb_close_conn&quot; block=&quot;NB-IoT 關閉連接&quot;" line98="    //% group=&quot;NB-IoT&quot;" line99="    export function nb_close_connection(): void {" line100="        serial.redirect(" line101="            SerialPin.P12," line102="            SerialPin.P8," line103="            BaudRate.BaudRate9600" line104="        )" line105="        serial.writeLine(&quot;AT+MIPLCLOSE=0&quot;)" line106="    }" line107="" line108="" line109="" line110="" line111="    /**" line112="     * NB-IoT 添加對象" line113="     * @param value describe value here, eg: 5" line114="     */" line115="" line116="    //% blockId=&quot;nb_add_obj&quot; block=&quot;NB-IoT 添加對象&quot;" line117="    //% group=&quot;NB-IoT&quot;" line118="    export function nb_add_obj(): void {" line119="        serial.redirect(" line120="            SerialPin.P12," line121="            SerialPin.P8," line122="            BaudRate.BaudRate9600" line123="        )" line124="        serial.writeLine(&quot;AT+MIPLADDOBJ=0, 3304, 2, \&quot;11\&quot;, 0, 0&quot;)" line125="    }" line126="" line127="" line128="    /**" line129="     * NB-IoT 通知對象" line130="     * @param value describe value here, eg: 5" line131="     */" line132="" line133="    //% blockId=&quot;nb_notify_obj&quot; block=&quot;NB-IoT 通知對象 %value&quot;" line134="    //% group=&quot;NB-IoT&quot;" line135="    export function nb_notify_obj(value: number): void {" line136="        serial.redirect(" line137="            SerialPin.P12," line138="            SerialPin.P8," line139="            BaudRate.BaudRate9600" line140="        )" line141="        serial.writeLine(&quot;AT+MIPLNOTIFY=0,0,3304,0,5700,4,4,&quot; + value + &quot;,0,0&quot;)" line142="    }" line143="" line144="" line145="    /**" line146="     * MQTT 設定 WiFi SSID" line147="     * @param value describe value here, eg: &quot;WIFI NAME&quot;" line148="     */" line149="" line150="    //% blockId=&quot;mqtt_wifi_ssid&quot; block=&quot;MQTT 設定 WiFi SSID: %value&quot;" line151="    //% group=&quot;MQTT&quot;" line152="    //% advanced=true" line153="    export function mqtt_wifi_ssid(value: string): void {" line154="        serial.redirect(" line155="            SerialPin.P12," line156="            SerialPin.P8," line157="            BaudRate.BaudRate9600" line158="        )" line159="        serial.writeLine(&quot;AT+SSID=&quot; + value)" line160="    }" line161="" line162="    /**" line163="     * MQTT 設定 WiFi 密碼" line164="     * @param value describe value here, eg: &quot;WIFI Password&quot;" line165="     */" line166="" line167="    //% blockId=&quot;mqtt_wifi_pw&quot; block=&quot;MQTT 設定 WiFi 密碼: %value&quot;" line168="    //% group=&quot;MQTT&quot;" line169="    //% advanced=true" line170="    export function mqtt_wifi_pw(value: string): void {" line171="        serial.redirect(" line172="            SerialPin.P12," line173="            SerialPin.P8," line174="            BaudRate.BaudRate9600" line175="        )" line176="        serial.writeLine(&quot;AT+PW=&quot; + value)" line177="    }" line178="" line179="    /**" line180="         * MQTT 設定產品ID" line181="         * @param value describe value here, eg: &quot;16001111&quot;" line182="         */" line183="" line184="    //% blockId=&quot;mqtt_set_pid&quot; block=&quot;MQTT 設定產品ID: %value&quot;" line185="    //% group=&quot;MQTT&quot;" line186="    //% advanced=true" line187="    export function mqtt_set_pid(value: number): void {" line188="        serial.redirect(" line189="            SerialPin.P12," line190="            SerialPin.P8," line191="            BaudRate.BaudRate9600" line192="        )" line193="        serial.writeLine(&quot;AT+PID=&quot; + value)" line194="    }" line195="" line196="    /**" line197="         * MQTT 設定設備ID" line198="         * @param value describe value here, eg: &quot;161200005&quot;" line199="         */" line200="" line201="    //% blockId=&quot;mqtt_set_did&quot; block=&quot;MQTT 設定設備ID: %value&quot;" line202="    //% group=&quot;MQTT&quot;" line203="    //% advanced=true" line204="    export function mqtt_set_did(value: number): void {" line205="        serial.redirect(" line206="            SerialPin.P12," line207="            SerialPin.P8," line208="            BaudRate.BaudRate9600" line209="        )" line210="        serial.writeLine(&quot;AT+DID=&quot; + value)" line211="    }" line212="" line213="    /**" line214="          * MQTT 設定鑒權密碼" line215="          * @param value describe value here, eg: &quot;device_pw&quot;" line216="          */" line217="" line218="    //% blockId=&quot;mqtt_set_dpw&quot; block=&quot;MQTT 設定鑒權密碼: %value&quot;" line219="    //% group=&quot;MQTT&quot;" line220="    //% advanced=true" line221="    export function mqtt_set_dpw(value: string): void {" line222="        serial.redirect(" line223="            SerialPin.P12," line224="            SerialPin.P8," line225="            BaudRate.BaudRate9600" line226="        )" line227="        serial.writeLine(&quot;AT+DPW=&quot; + value)" line228="    }" line229="" line230="    /**" line231="     * MQTT 檢視設備信息 " line232="     */" line233="" line234="    //% blockId=&quot;mqtt_check_info&quot; block=&quot;MQTT 檢視設備信息&quot;" line235="    //% group=&quot;MQTT&quot;" line236="    export function mqtt_check_info(): void {" line237="" line238="        mqtt_check_winfo()" line239="        basic.pause(100)" line240="        mqtt_check_gpid()" line241="        basic.pause(100)" line242="        mqtt_check_gdid()" line243="        basic.pause(100)" line244="        mqtt_check_gdpw()" line245="" line246="" line247="" line248="    }" line249="    " line250="    /**" line251="     * MQTT 檢視設備Wi-Fi信息 " line252="     */" line253="    //% blockId=&quot;mqtt_check_winfo&quot; block=&quot;MQTT 檢視設備Wi-Fi信息&quot;" line254="    //% group=&quot;MQTT&quot;" line255="    export function mqtt_check_winfo(): void {" line256="        serial.redirect(" line257="            SerialPin.P12," line258="            SerialPin.P8," line259="            BaudRate.BaudRate9600" line260="        )" line261="        serial.writeLine(&quot;AT+WINFO?&quot;)  " line262="    }" line263="" line264="    /**" line265="     * MQTT 檢視產品ID" line266="     */" line267="    //% blockId=&quot;mqtt_check_gpid&quot; block=&quot;MQTT 檢視產品ID&quot;" line268="    //% group=&quot;MQTT&quot;" line269="    export function mqtt_check_gpid(): void {" line270="        serial.redirect(" line271="            SerialPin.P12," line272="            SerialPin.P8," line273="            BaudRate.BaudRate9600" line274="        )" line275="        serial.writeLine(&quot;AT+GPID?&quot;)" line276="    }" line277="    /**" line278=" * MQTT 檢視設備ID" line279=" */" line280="    //% blockId=&quot;mqtt_check_gdid&quot; block=&quot;MQTT 檢視設備ID&quot;" line281="    //% group=&quot;MQTT&quot;" line282="    export function mqtt_check_gdid(): void {" line283="        serial.redirect(" line284="            SerialPin.P12," line285="            SerialPin.P8," line286="            BaudRate.BaudRate9600" line287="        )" line288="        serial.writeLine(&quot;AT+GDID?&quot;)" line289="    }" line290="    /**" line291=" * MQTT 檢視設備鑒權密碼" line292=" */" line293="    //% blockId=&quot;mqtt_check_gdpw&quot; block=&quot;MQTT 檢視設備鑒權密碼&quot;" line294="    //% group=&quot;MQTT&quot;" line295="    export function mqtt_check_gdpw(): void {" line296="        serial.redirect(" line297="            SerialPin.P12," line298="            SerialPin.P8," line299="            BaudRate.BaudRate9600" line300="        )" line301="        serial.writeLine(&quot;AT+GDPW?&quot;)" line302="    }" line303="" line304="" line305="" line306="    " line307="" line308="    /**" line309="     * MQTT 連接WiFi " line310="     * @param value describe value here, eg: 5" line311="     */" line312="" line313="    //% blockId=&quot;mqtt_wifi_conn&quot; block=&quot;MQTT 連接WiFi,嘗試次數 %value&quot;" line314="    //% group=&quot;MQTT&quot;" line315="    export function mqtt_wifi_conn(value: number): void {" line316="        serial.redirect(" line317="            SerialPin.P12," line318="            SerialPin.P8," line319="            BaudRate.BaudRate9600" line320="        )" line321="        serial.writeLine(&quot;AT+CONN=&quot; + value)" line322="    }" line323="" line324="    /**" line325="     * MQTT 檢查WiFi連接" line326="     */" line327="" line328="    //% blockId=&quot;mqtt_check_wificonn&quot; block=&quot;MQTT 檢查WiFi連接&quot;" line329="    //% group=&quot;MQTT&quot;" line330="    export function mqtt_check_wificonn(): void {" line331="        serial.redirect(" line332="            SerialPin.P12," line333="            SerialPin.P8," line334="            BaudRate.BaudRate9600" line335="        )" line336="        serial.writeLine(&quot;AT+CONN?&quot;)" line337="    }" line338="" line339="" line340="    /**" line341="     * MQTT 連接OneNET " line342="     * @param value describe value here, eg: 5" line343="     */" line344="" line345="    //% blockId=&quot;mqtt_onenet_conn&quot; block=&quot;MQTT 連接OneNET,嘗試次數 %value&quot;" line346="    //% group=&quot;MQTT&quot;" line347="    export function mqtt_onenet_conn(value: number): void {" line348="        serial.redirect(" line349="            SerialPin.P12," line350="            SerialPin.P8," line351="            BaudRate.BaudRate9600" line352="        )" line353="        serial.writeLine(&quot;AT+MQTTCONN=&quot; + value)" line354="    }" line355="" line356="    /**" line357="     * MQTT 發送數據 " line358="     * @param topic 發送的主題名稱, eg: Temperature" line359="     * @param value 發送的數值, eg: 30.2" line360="     */" line361="" line362="    //% blockId=&quot;mqtt_send_data&quot; block=&quot;MQTT 發送主題 %topic 數值為 %value&quot;" line363="    //% group=&quot;MQTT&quot;" line364="    export function mqtt_send_data(topic: string, value: number): void {" line365="        serial.redirect(" line366="            SerialPin.P12," line367="            SerialPin.P8," line368="            BaudRate.BaudRate9600" line369="        )" line370="        serial.writeLine(&quot;AT+SEND=&quot; + topic + &quot;,&quot; + value)" line371="    }" line372="" line373="" line374="    /**" line375="        * MQTT 檢查接收數據 " line376="        * 回傳由OneNeT平台下傳的訊息,如非下傳的訊息則回傳空白" line377="        * @param data Input String, eg: &quot;Recieve_String&quot;" line378="        */" line379="" line380="    //% blockId=&quot;mqtt_check_revcdata&quot; block=&quot;MQTT 檢查接收數據  %data&quot;" line381="    //% group=&quot;MQTT&quot;" line382="    export function mqtt_check_revcdata(data: string): string {" line383="        if (data.includes(&quot;[R]&quot;)) {" line384="            return data.substr(3, data.length)" line385="        }" line386="        return &quot;&quot;" line387="    }" line388="" line389="" line390="    /**" line391="        * MQTT 模塊重啟 " line392="        * 強制重新啟動MQTT模組" line393="        */" line394="" line395="    //% blockId=&quot;mqtt_restart&quot; block=&quot;MQTT 模塊重啟&quot;" line396="    //% group=&quot;MQTT&quot;" line397="    export function mqtt_restart(): void {" line398="        serial.redirect(" line399="            SerialPin.P12," line400="            SerialPin.P8," line401="            BaudRate.BaudRate9600" line402="        )" line403="        serial.writeLine(&quot;AT+RES&quot; )" line404="    }" line405="" line406="    /**" line407="        * MQTT 模塊版本 " line408="        * 檢查 MQTT 模塊版本" line409="        */" line410="" line411="    //% blockId=&quot;mqtt_check_ver&quot; block=&quot;檢查 MQTT 模塊版本&quot;" line412="    //% group=&quot;MQTT&quot;" line413="    export function mqtt_check_ver(): void {" line414="        serial.redirect(" line415="            SerialPin.P12," line416="            SerialPin.P8," line417="            BaudRate.BaudRate9600" line418="        )" line419="        serial.writeLine(&quot;AT+VER?&quot;)" line420="    }" line421="" line422="" line423="    /**" line424="        * MQTT 檢查上線狀態 " line425="        */" line426="    //% blockId=&quot;mqtt_check_mconn&quot; block=&quot;檢查 MQTT 上線狀態&quot;" line427="    //% group=&quot;MQTT&quot;" line428="    export function mqtt_check_mconn(): void {" line429="        serial.redirect(" line430="            SerialPin.P12," line431="            SerialPin.P8," line432="            BaudRate.BaudRate9600" line433="        )" line434="        serial.writeLine(&quot;AT+MQTT?&quot;)" line435="    }" line436="" line437="" line438="    /**" line439="           * 設定所有MQTT信息 " line440="           * @param ssid Wi-Fi名稱, eg: &quot;Wi-Fi_Name&quot;" line441="           * @param password Wi-Fi 密碼, eg: &quot;Wi-Fi_Password&quot;" line442="           * @param pid 產品ID, eg: &quot;16001111&quot;" line443="           * @param did 設備ID, eg: &quot;161200005&quot;" line444="           * @param dpw 鑒權密碼, eg: &quot;device_pw&quot;" line445="           * @param autoConnect 是否需要設定後馬上進行連接?" line446="           */" line447="    //% blockId=&quot;mqtt_master_setup&quot; block=&quot;設定MQTT信息|Wi-Fi SSID $ssid|Wi-Fi 密碼 $password|產品ID $pid|設備ID $did|鑒權密碼 $dpw|自動連接 $autoConnect&quot;" line448="    //% autoConnect.defl=true" line449="    export function mqtt_master_setup(ssid: string, password: string, pid: number, did: number, dpw: string, autoConnect: boolean): void {" line450="        mqtt_wifi_ssid(ssid)" line451="        basic.pause(100)" line452="        mqtt_wifi_pw(password)" line453="        basic.pause(100)" line454="        mqtt_set_pid(pid)" line455="        basic.pause(100)" line456="        mqtt_set_did(did)" line457="        basic.pause(100)" line458="        mqtt_set_dpw(dpw)" line459="        basic.pause(100)" line460="        if(autoConnect){" line461="            mqtt_wifi_conn(5)" line462="            basic.pause(500)" line463="            mqtt_onenet_conn(5)" line464="            basic.pause(500)" line465="        }" line466="    }" line467="" line468="" line469="}" numlines="470"></mutation></block></next></block></next></block></statement></block></xml>